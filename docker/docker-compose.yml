# For rootless podman, use: podman run --userns=keep-id ...
# For docker, volumes will use the container's UID 1000
# See test-compose/ directory for working examples

services:
  cli:
    image: email-archiver:latest
    build:
      context: ..
    volumes:
      - ${CONFIG_PATH:-./config}:/home/archiver/.config:ro
      - ${DATA_PATH:-./data}:/home/archiver/Mail/imap:rw
      - ${STATE_PATH:-./state}:/home/archiver/.local/state/email-archiver:rw
    environment:
      IMAP_PASSWORD: ${IMAP_PASSWORD:?IMAP_PASSWORD must be set}

  scheduler:
    image: email-archiver:latest
    build:
      context: ..
    entrypoint: ["/usr/local/bin/scheduler"]
    volumes:
      - ${CONFIG_PATH:-./config}:/home/archiver/.config:ro
      - ${DATA_PATH:-./data}:/home/archiver/Mail/imap:rw
      - ${STATE_PATH:-./state}:/home/archiver/.local/state/email-archiver:rw
    environment:
      IMAP_PASSWORD: ${IMAP_PASSWORD:?IMAP_PASSWORD must be set}
      SCHEDULE_INTERVAL: ${SCHEDULE_INTERVAL:-3600}
      ARCHIVER_ARGS: ${ARCHIVER_ARGS:-}
    restart: unless-stopped
