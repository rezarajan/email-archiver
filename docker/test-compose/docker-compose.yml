services:
  cli:
    image: email-archiver:latest
    build:
      context: ../..
    userns_mode: "keep-id"
    volumes:
      - ${CONFIG_PATH:-./config}:/home/archiver/.config:ro,z
      - ${DATA_PATH:-./data}:/home/archiver/Mail/imap:rw,z
      - ${STATE_PATH:-./state}:/home/archiver/.local/state/email-archiver:rw,z
    environment:
      IMAP_PASSWORD: ${IMAP_PASSWORD:?IMAP_PASSWORD must be set}

  scheduler:
    image: email-archiver:latest
    build:
      context: ../..
    userns_mode: "keep-id"
    entrypoint: ["/usr/local/bin/scheduler"]
    volumes:
      - ${CONFIG_PATH:-./config}:/home/archiver/.config:ro,z
      - ${DATA_PATH:-./data}:/home/archiver/Mail/imap:rw,z
      - ${STATE_PATH:-./state}:/home/archiver/.local/state/email-archiver:rw,z
    environment:
      IMAP_PASSWORD: ${IMAP_PASSWORD:?IMAP_PASSWORD must be set}
      SCHEDULE_INTERVAL: ${SCHEDULE_INTERVAL:-3600}
      ARCHIVER_ARGS: ${ARCHIVER_ARGS:-}
    restart: unless-stopped
